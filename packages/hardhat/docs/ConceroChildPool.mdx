# Solidity API

## ConceroChildPool_CallerIsNotTheProxy

```solidity
error ConceroChildPool_CallerIsNotTheProxy(address delegatedCaller)
```

error emitted when the caller is not the Orchestrator

## ConceroChildPool_CallerIsNotConcero

```solidity
error ConceroChildPool_CallerIsNotConcero(address caller)
```

error emitted when a not-concero address call takeLoan

## ConceroChildPool_InvalidAddress

```solidity
error ConceroChildPool_InvalidAddress()
```

error emitted when the receiver is the address(0)

## ConceroChildPool_NotMessenger

```solidity
error ConceroChildPool_NotMessenger(address caller)
```

error emitted when the caller is a non-messenger address

## ConceroChildPool_NotContractOwner

```solidity
error ConceroChildPool_NotContractOwner()
```

error emitted when the caller is not the owner of the contract

## ConceroChildPool_SenderNotAllowed

```solidity
error ConceroChildPool_SenderNotAllowed(address sender)
```

error emitted when the CCIP message sender is not allowed.

## ConceroChildPool_ThereIsNoPoolToDistribute

```solidity
error ConceroChildPool_ThereIsNoPoolToDistribute()
```

error emitted if the array is empty.

## ConceroChildPool_RequestAlreadyProceeded

```solidity
error ConceroChildPool_RequestAlreadyProceeded(bytes32 reqId)
```

## ConceroChildPool_WithdrawAlreadyPerformed

```solidity
error ConceroChildPool_WithdrawAlreadyPerformed()
```

## ConceroChildPool

### CL_FUNCTIONS_CALLBACK_GAS_LIMIT

```solidity
uint32 CL_FUNCTIONS_CALLBACK_GAS_LIMIT
```

### ConceroChildPool_CCIPReceived

```solidity
event ConceroChildPool_CCIPReceived(bytes32 ccipMessageId, uint64 srcChainSelector, address sender, address token, uint256 amount)
```

event emitted when a Cross-chain tx is received.

### ConceroChildPool_CCIPSent

```solidity
event ConceroChildPool_CCIPSent(bytes32 messageId, uint64 destinationChainSelector, address receiver, address linkToken, uint256 fees)
```

event emitted when a Cross-chain message is sent.

### ConceroChildPool_LoanTaken

```solidity
event ConceroChildPool_LoanTaken(address receiver, uint256 amount)
```

event emitted in takeLoan when a loan is taken

### ConceroChildPool_ConceroSendersUpdated

```solidity
event ConceroChildPool_ConceroSendersUpdated(uint64 chainSelector, address conceroContract, uint256 isAllowed)
```

event emitted when a allowed Cross-chain contract is updated

### ConceroChildPool_PoolReceiverUpdated

```solidity
event ConceroChildPool_PoolReceiverUpdated(uint64 chainSelector, address pool)
```

event emitted when a new pool is added

### ConceroChildPool_ChainAndAddressRemoved

```solidity
event ConceroChildPool_ChainAndAddressRemoved(uint64 chainSelector)
```

event emitted when a pool is removed

### onlyProxyContext

```solidity
modifier onlyProxyContext()
```

modifier to ensure if the function is being executed in the proxy context.

### onlyMessenger

```solidity
modifier onlyMessenger()
```

modifier to check if the caller is the an approved messenger

### onlyOwner

```solidity
modifier onlyOwner()
```

### _onlyAllowlistedSenderOfChainSelector

```solidity
modifier _onlyAllowlistedSenderOfChainSelector(uint64 _chainSelector, address _sender)
```

CCIP Modifier to check Chains And senders

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 | Id of the source chain of the message |
| _sender | address | address of the sender contract |

### receive

```solidity
receive() external payable
```

### constructor

```solidity
constructor(address _infraProxy, address _proxy, address _link, address _ccipRouter, address _usdc, address _owner, address[3] _messengers) public
```

### ccipSendToPool

```solidity
function ccipSendToPool(uint64 _chainSelector, address _lpAddress, uint256 _amountToSend, bytes32 _withdrawId) external
```

Function called by Messenger process withdraw calls

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 | The destination chain selector will always be from Parent Pool |
| _lpAddress | address | the LP that requested withdraw. |
| _amountToSend | uint256 | the amount to redistribute between pools. |
| _withdrawId | bytes32 |  |

### distributeLiquidity

```solidity
function distributeLiquidity(uint64 _chainSelector, uint256 _amountToSend, bytes32 _requestId) external
```

Function called by Messenger to send USDC to a recently added pool.

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 | The chain selector of the new pool |
| _amountToSend | uint256 | the amount to redistribute between pools. |
| _requestId | bytes32 |  |

### liquidatePool

```solidity
function liquidatePool(bytes32 distributeLiquidityRequestId) external
```

helper function to remove and distribute liquidity when a pool is removed.

_this functions should be called only if there is no transaction being processed
If Orchestrator took a loan and the money didn't rebalance yet, it will be left behind._

### takeLoan

```solidity
function takeLoan(address _token, uint256 _amount, address _receiver) external
```

function for Concero Orchestrator contract to take loans

_only the Orchestrator contract should be able to call this function
for ether transfer, the _receiver need to be known and trusted_

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _token | address | address of the token being loaned |
| _amount | uint256 | being loaned |
| _receiver | address | address of the user that will receive the amount |

### setConceroContractSender

```solidity
function setConceroContractSender(uint64 _chainSelector, address _contractAddress, uint256 _isAllowed) external payable
```

function to manage the Cross-chains Concero contracts

_only owner can call it
it's payable to save some gas.
this functions is used on ConceroPool.sol_

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 | chain identifications |
| _contractAddress | address | address of the Cross-chains Concero contracts |
| _isAllowed | uint256 | 1 == allowed | Any other value == not allowed |

### setPools

```solidity
function setPools(uint64 _chainSelector, address _pool) external payable
```

function to manage the Cross-chain ConceroPool contracts

_only owner can call it
it's payable to save some gas._

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 | chain identifications |
| _pool | address | address of the Cross-chain ConceroPool contract |

### removePools

```solidity
function removePools(uint64 _chainSelector) external payable
```

Function to remove Cross-chain address disapproving transfers

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 | the CCIP chainSelector for the specific chain |

### _ccipReceive

```solidity
function _ccipReceive(struct Client.Any2EVMMessage any2EvmMessage) internal
```

CCIP function to receive bridged values

_only allowed chains and sender must be able to deliver a message in this function._

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| any2EvmMessage | struct Client.Any2EVMMessage | the CCIP message |

### _ccipSend

```solidity
function _ccipSend(uint64 _chainSelector, address _lpAddress, uint256 _amount) internal returns (bytes32)
```

Function to Distribute Liquidity across Concero Pools and process withdrawals

_This function will sent the address of the user as data. This address will be used to update the mapping on ParentPool.
when processing withdrawals, the _chainSelector will always be the index 0 of s_poolChainSelectors_

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _chainSelector | uint64 |  |
| _lpAddress | address | The liquidity provider that requested Withdraw. If it's a rebalance, it will be address(0) |
| _amount | uint256 | amount of the token to be sent |

### _isMessenger

```solidity
function _isMessenger(address _messenger) internal view returns (bool)
```

Function to check if a caller address is an allowed messenger

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _messenger | address | the address of the caller |

